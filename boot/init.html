<!DOCTYPE html>
<html>
<head>
    <title>æ€æºç¬”è®°</title>
    <meta charset="UTF-8">
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            background-color: #212224;
            text-align: center;
            color: #c9d1d9;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }

        h2 {
            margin: 0 0 4px 0;
            line-height: 24px;
        }

        .b3-select {
            border: 1px solid #9aa0a6;
            border-radius: 4px;
            padding: 4px 8px;
            line-height: 20px;
            box-sizing: border-box;
            color: #c9d1d9;
            transition: box-shadow 120ms 0ms cubic-bezier(0, 0, 0.2, 1);
            background-color: #212224;
            height: 28px;
            font-size: 14px;
            width: 96px;
        }

        .b3-select:focus {
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.38);
            outline: none;
        }

        .b3-button {
            cursor: pointer;
            color: #fff;
            border-radius: 4px;
            line-height: 20px;
            padding: 4px 8px;
            background-color: #1f6feb;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);
            border: 0;
            box-sizing: border-box;
            text-align: center;
            width: 96px;
        }

        .b3-button:hover, .b3-button:focus {
            text-decoration: none;
            background-color: #388bfd;
            box-shadow: 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12)
        }

        .b3-button:active {
            box-shadow: 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12)
        }

        .b3-label {
            padding: 12px 24px;
            line-height: 20px;
            display: flex;
            text-align: left;
            border-bottom: 1px solid rgba(230, 230, 230, .06);
        }

        .b3-label__text {
            color: #9aa0a6;
            font-size: 14px;
            margin-top: 4px;
        }

        .fn__space {
            width: 8px;
            flex-shrink: 0;
        }

        .fn__flex-center {
            align-self: center;
        }

        .svg {
            position: absolute;
            right: 24px;
            top: 0;
            width: 12px;
            fill: #9aa0a6;
            padding: 5px;
            cursor: pointer;
            z-index: 1;
        }

        .svg:hover {
            background-color: #212224;
            fill: #fff;
        }

        #close {
            right: 0;
            width: 8px;
            padding: 7px 7px;
        }

        #close:hover {
            background-color: #d23f31;
        }

        a {
            text-decoration: none;
            color: #1f6feb;
        }

        a:hover {
            text-decoration: underline;
        }

        .fn__none {
            display: none !important;
        }

        .slogan {
            color: #9aa0a6;
            font-size: 15px;
        }

        .version {

        }

        kbd {
            padding: 2px 4px;
            font: 75% Consolas, "Liberation Mono", Menlo, Courier, monospace;
            line-height: 1;
            color: #9aa0a6;
            vertical-align: middle;
            background-color: #292a2d;
            border: solid 1px rgba(230, 230, 230, .06);
            border-radius: 3px;
            box-shadow: inset 0 -1px 0 rgba(230, 230, 230, .06);
        }

        .fn__flex-column {
            display: flex;
            flex-direction: column;
            width: 640px;
            max-height: 640px;
            height: 100%;
        }

        .fn__flex-1 {
            flex: 1;
        }

        .feedback {
            display: flex;
            justify-content: space-around;
            font-size: 14px
        }

        .drag {
            -webkit-app-region: drag;
            height: 22px;
            cursor: pointer;
            position: absolute;
            top: 0;
            background: #353637;
            left: 0;
            right: 0;
        }
    </style>
</head>
<body>
<div id="zhCN" class="fn__flex-column">
    <div class="fn__flex-1"></div>
    <img style="width: 88px;margin: 0 auto" src="../../stage/icon.png">
    <h2>æ€æºç¬”è®°</h2>
    <div class="slogan">æ„å»ºä½ æ°¸æ’çš„æ•°å­—èŠ±å›­</div>
    <div class="fn__flex-1"></div>
    <label class="b3-label">
        <div>
            ğŸŒ å¤–è§‚è¯­è¨€
            <div class="b3-label__text">ç”¨æˆ·ç•Œé¢è¯­è¨€ï¼Œåç»­å¯åœ¨ <kbd>è®¾ç½®</kbd> - <kbd>å¤–è§‚</kbd> ä¸­åˆ‡æ¢</div>
        </div>
        <div class="fn__space"></div>
        <div class="fn__flex-1"></div>
        <select class="b3-select lang">
            <option value="en-US">English</option>
            <option value="fr-FR">FranÃ§ais</option>
            <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
            <option value="zh-CHT">ç¹é«”ä¸­æ–‡</option>
        </select>
    </label>
    <label class="b3-label">
        <div>
            ğŸ—‚ï¸ å·¥ä½œç©ºé—´
            <div class="b3-label__text"> å·¥ä½œç©ºé—´ç”¨äºå­˜æ”¾æ•°æ®ï¼Œåç»­å¯åœ¨ <kbd>è®¾ç½®</kbd> - <kbd>å…³äº</kbd> ä¸­åˆ‡æ¢</div>
        </div>
        <div class="fn__space"></div>
        <div class="fn__flex-1"></div>
        <button class="b3-button fn__flex-center choosePath">é€‰æ‹©</button>
    </label>
    <div class="fn__flex-1"></div>
    <div class="feedback">
        <span>â¤ï¸ <a href="https://ld246.com/article/1649901726096" target="_blank">æ±‚åŠ©åé¦ˆå»ºè®®</a></span>
        <span>ğŸ˜ï¸ <a href="https://ld246.com/article/1640266171309" target="_blank">ç”¨æˆ·ç¤¾åŒºæ±‡æ€»</a></span>
        <span><a href="https://b3log.org/siyuan/download.html" target="_blank" class="version"></a></span>
    </div>
    <div class="fn__flex-1"></div>
</div>
<div class="fn__none fn__flex-column" id="enUS">
    <div class="fn__flex-1"></div>
    <img style="width: 88px;margin: 0 auto" src="../../stage/icon.png">
    <h2>SiYuan</h2>
    <div class="slogan">Build Your Eternal Digital Garden</div>
    <div class="fn__flex-1"></div>
    <label class="b3-label">
        <div>
            ğŸŒ Language
            <div class="b3-label__text">User interface language, which can be switched later in <br>
                <kbd>Settings</kbd> - <kbd>Appearance</kbd>
            </div>
        </div>
        <div class="fn__space"></div>
        <div class="fn__flex-1"></div>
        <select class="b3-select lang">
            <option value="en-US">English</option>
            <option value="fr-FR">FranÃ§ais</option>
            <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
            <option value="zh-CHT">ç¹é«”ä¸­æ–‡</option>
        </select>
    </label>
    <label class="b3-label">
        <div>
            ğŸ—‚ï¸ Workspace
            <div class="b3-label__text">The workspace is used to store data, which can be switched later in <br>
                <kbd>Settings</kbd> - <kbd>About</kbd>
            </div>
        </div>
        <div class="fn__space"></div>
        <div class="fn__flex-1"></div>
        <button class="b3-button fn__flex-center choosePath">Select</button>
    </label>
    <div class="fn__flex-1"></div>
    <div class="feedback">
        <span>â¤ï¸ Feedback via <a href="https://github.com/siyuan-note/siyuan/issues"
                                 target="_blank">GitHub Issues</a></span>
        <span><a href="https://b3log.org/siyuan/en/download.html" target="_blank" class="version"></a></span>
    </div>
    <div class="fn__flex-1"></div>
</div>
<svg class="svg" id="min" viewBox="0 0 32 32">
    <path d="M1.333 14.667h29.333q1.333 0 1.333 1.333v0q0 1.333-1.333 1.333h-29.333q-1.333 0-1.333-1.333v0q0-1.333 1.333-1.333z"></path>
</svg>
<svg class="svg" id="close" viewBox="0 0 32 32">
    <path d="M32 3.221l-12.779 12.779 12.779 12.779-3.221 3.221-12.779-12.779-12.779 12.779-3.221-3.221 12.779-12.779-12.779-12.779 3.221-3.221 12.779 12.779 12.779-12.779z"></path>
</svg>
<div class="drag"></div>
<script>
  const getSearch = (key) => {
    if (window.location.search.indexOf('?') === -1) {
      return ''
    }
    let value = ''
    const data = window.location.search.split('?')[1].split('&')
    data.find(item => {
      const keyValue = item.split('=')
      if (keyValue[0] === key) {
        value = keyValue[1]
        return true
      }
    })
    return value
  }

  const setLang = (lang) => {
    if (lang === 'zh-CN') {
      document.title = `æ€æºç¬”è®° v${getSearch('v')}`
      document.getElementById('zhCN').classList.remove('fn__none')
      document.getElementById('enUS').classList.add('fn__none')
    } else {
      document.title = `SiYuan v${getSearch('v')}`
      document.getElementById('zhCN').classList.add('fn__none')
      document.getElementById('enUS').classList.remove('fn__none')
    }
  }

  setLang(navigator.language)

  document.querySelectorAll('.version').forEach(item => {
    item.textContent = `ğŸ”– v${getSearch('v')}`
  })

  document.querySelectorAll('.lang').forEach(item => {
    item.value = navigator.language
    item.addEventListener('change', () => {
      document.querySelectorAll('.lang').forEach(item1 => {
        item1.value = item.value
      })
      setLang(item.value)
    })
  })

  document.getElementById('close').addEventListener('click', () => {
    const {ipcRenderer} = require('electron')
    ipcRenderer.send('siyuan-first-quit')
  })
  document.getElementById('min').addEventListener('click', () => {
    const {getCurrentWindow} = require('@electron/remote')
    getCurrentWindow().minimize()
  })

  document.querySelectorAll('.choosePath').forEach((item) => {
    item.addEventListener('click', () => {
      const {dialog} = require('@electron/remote')
      const path = require('path')
      dialog.showOpenDialog({
        defaultPath: path.join(decodeURIComponent(getSearch('home')), 'Documents'),
        properties: ['openDirectory', 'createDirectory'],
      }).then((result) => {
        if (!result.canceled) {
          const {ipcRenderer} = require('electron')
          const fs = require('fs')
          const initPath = path.join(result.filePaths[0], 'SiYuan')
          if (!fs.existsSync(initPath)) {
            fs.mkdirSync(initPath, {mode: 0o755, recursive: true})
          }
          ipcRenderer.send('siyuan-first-init',
            `${initPath}-${document.querySelector('.lang').value.replaceAll('-', '_')}`)
        }
      })
    })
  })
</script>
</body>
</html>
